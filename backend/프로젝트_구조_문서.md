
## 📂 폴더별 역할 설명

### �� `main.py` - 메인 애플리케이션
- **역할**: FastAPI 애플리케이션의 진입점
- **기능**: 
  - FastAPI 앱 초기화
  - CORS 설정
  - 벡터 스토어 초기화
  - 라우터 등록 (챗봇, PDF)
  - 서버 실행

### �� `models/` - 데이터 모델
- **역할**: API 요청/응답을 위한 Pydantic 모델 정의
- **목적**: 데이터 검증 및 직렬화

### �� `services/` - 비즈니스 로직
- **역할**: 핵심 비즈니스 로직을 담당하는 서비스 클래스들
- **목적**: 코드 재사용성과 유지보수성 향상

### 🛠️ `utils/` - 유틸리티 함수
- **역할**: 공통으로 사용되는 헬퍼 함수들
- **목적**: 코드 중복 제거 및 모듈화

### ⚙️ `config/` - 설정 관리
- **역할**: 애플리케이션 설정 및 초기화 코드
- **목적**: 설정의 중앙화 및 관리

### �� `api/` - API 엔드포인트
- **역할**: HTTP API 엔드포인트 정의
- **목적**: RESTful API 구조 구현

### 📁 `data/` - PDF 데이터 파일
- **역할**: RAG 시스템의 지식 베이스가 되는 PDF 문서들
- **목적**: 학사 관련 정보 제공을 위한 원본 데이터

## 📄 개별 파일 상세 설명

### 🏠 `main.py`
```python
# 주요 기능:
- FastAPI 애플리케이션 초기화
- CORS 미들웨어 설정
- 벡터 스토어 초기화
- 라우터 등록 (챗봇, PDF)
- 서버 실행 (uvicorn)

# 특징:
- 모듈화된 구조로 깔끔한 진입점
- 환경 변수 기반 설정
```

### 📊 `models/chat_models.py`
```python
# 주요 클래스:
- ChatMessage: 사용자 메시지 요청 모델
- ChatResponse: AI 응답 모델

# 역할:
- API 요청/응답 데이터 검증
- 자동 직렬화/역직렬화
- 타입 안전성 보장
```

### 🔧 `services/chat_service.py`
```python
# 주요 클래스:
- ChatService: 챗봇 핵심 서비스

# 주요 메서드:
- process_chat(): 전체 챗봇 처리 로직

# 처리 순서:
1. 언어 감지 및 번역 (다국어 지원)
2. 대화 맥락 구성 (이전 대화 기억)
3. RAG 검색 (관련 문서 찾기)
4. AI 답변 생성 (Gemini 모델)
5. 답변 번역 (사용자 언어로)
6. 대화 히스토리 업데이트

# 특징:
- 의존성 주입 패턴 사용
- 각 단계별 명확한 분리
```

### 🔧 `services/translator_service.py`
```python
# 주요 기능:
- 다국어 감지 (한국어, 미얀마어, 영어, 베트남어)
- Google Translate API 활용
- 질문 번역 (한국어로)
- 답변 번역 (사용자 언어로)

# 주요 메서드:
- detect_and_translate(): 언어 감지 및 번역
- translate_response(): 응답 번역

# 특징:
- 지원 언어: ko, my, en, vi
- 오류 처리 및 폴백 메커니즘
```

### 🔧 `services/unified_prompt_service.py`
```python
# 주요 기능:
- Gemini 2.5 Flash Lite 모델 활용
- SystemMessage + HumanMessage 구조 사용
- RAG 결과와 대화 맥락을 통합한 프롬프트 생성
- 학사 관련 질문에 특화된 답변 생성

# 주요 메서드:
- process_question(): 통합된 질문 처리

# 프롬프트 구성:
1. 참고 문서 (RAG 결과)
2. 대화 맥락 (이전 대화)
3. 현재 질문
4. 답변 지시사항

# 특징:
- LangChain 구조 개선 (SystemMessage 사용)
- 맥락 기반 답변 생성
- 토큰 사용량 최적화
```

### 🛠️ `utils/chat_context.py`
```python
# 주요 기능:
- 대화 히스토리 관리 (메모리 기반)
- 최근 10개 대화 저장
- 최근 3개 대화로 맥락 구성

# 주요 함수:
- get_chat_context(): 대화 맥락 구성
- update_chat_history(): 히스토리 업데이트

# 특징:
- 현재 메시지는 맥락에서 제외
- 메모리 효율성 고려
- 자연스러운 대화 흐름 지원
```

### 🛠️ `utils/rag_utils.py`
```python
# 주요 기능:
- LangChain 벡터 스토어에서 유사 문서 검색
- PDF 문서 조각들을 참고 자료로 변환
- 상위 3개 문서 반환 (확장 가능)

# 주요 함수:
- search_similar_documents(): 유사 문서 검색

# 특징:
- 각 문서 3개(각 문서당 1000자 크기)ai에게 전달할때는 각 문서들을 500자씩 잘라서 전달,500자 * 문서 3개 = 총 1500자 전달
- 500자 길이 제한으로 토큰 절약
- 한국어 특화 임베딩 모델 사용
- 오류 처리 및 로깅
```

### ⚙️ `config/vector_store.py`
```python
# 주요 기능:
- PostgreSQL + pgvector 벡터 데이터베이스 연결
- 한국어 특화 임베딩 모델 (KURE-v1) 로드
- 벡터 스토어 초기화 및 관리

# 주요 함수:
- initialize_vector_store(): 벡터 스토어 초기화
- get_vector_store(): 벡터 스토어 인스턴스 반환

# 특징:
- 싱글톤 패턴으로 인스턴스 관리
- 오류 처리 및 폴백 메커니즘
```

### 🌐 `api/chat_routes.py`
```python
# 주요 기능:
- 챗봇 API 엔드포인트 정의
- 서비스 의존성 주입
- HTTP 요청/응답 처리

# 엔드포인트:
- POST /api/chat: 챗봇 대화 처리

# 특징:
- Pydantic 모델 기반 검증
- 자동 직렬화/역직렬화
```

### �� `api/pdf_routes.py`
```python
# 주요 기능:
- PDF 관련 API 엔드포인트 정의
- PDF 데이터 임포트 기능

# 엔드포인트:
- POST /api/import-pdf: PDF 데이터 벡터화

# 특징:
- 비동기 처리 지원
- 오류 처리 및 응답
```

### �� `pdf_importer.py`
```python
# 주요 기능:
- PDF 파일을 텍스트로 변환
- 텍스트를 벡터로 변환하여 PostgreSQL에 저장
- RAG 검색을 위한 데이터 준비

# 주요 함수:
- create_vector_store(): 벡터 스토어 생성

# 청킹 설정:
- chunk_size: 1000자
- chunk_overlap: 200자
- 분할 기준: 문단 > 줄 > 단어 > 문자

# 특징:
- 한국어 특화 임베딩 모델 사용
- PostgreSQL + pgvector 활용
```

### 📁 `data/` - PDF 데이터 파일
```python
# 포함된 PDF 파일들:
- 명지전문대학_MJC소개_총장소개_역대학장.pdf
- 명지전문대학 _ 학부_학과안내 _ 공학ㆍ정보학부 _ AI게임소프트웨어학과 _ 학과소개.pdf
- 명지전문대학 _ 학부_학과안내 _ 공학ㆍ정보학부 _ 컴퓨터보안공학과 _ 학과소개.pdf
- 명지전문대학 _ 학사서비스 _ 학사안내 _ 수업 _ 출석인정.pdf
- 명지전문대학 _ 학사서비스 _ 학사안내 _ 학적 _ 휴학.pdf
- 명지전문대학 _ MJC소개 _ 총장소개 _ 인사말.pdf

# 특징:
- 학사 관련 다양한 정보 포함
- RAG 시스템의 지식 베이스 역할
- 벡터화되어 검색 가능
```

### 🧪 `test_api.py`
```python
# 주요 기능:
- API 엔드포인트 테스트
- 다양한 언어로 테스트 케이스 실행
- 성능 및 기능 검증

# 테스트 케이스:
- 헬스 체크 테스트
- 채팅 API 테스트
- 잘못된 요청 테스트
- 대화 흐름 테스트
- 수동 채팅 모드

# 특징:
- 인터랙티브 테스트 지원
- 다양한 시나리오 커버
```

## �� 데이터 흐름

사용자 메시지
↓
[main.py] FastAPI 라우팅
↓
[api/chat_routes.py] API 엔드포인트
↓
[services/chat_service.py] 핵심 처리 로직
↓
[services/translator_service.py] 언어 감지/번역
↓
[utils/chat_context.py] 대화 맥락 구성
↓
[utils/rag_utils.py] RAG 검색
↓
[services/unified_prompt_service.py] AI 답변 생성
↓
[services/translator_service.py] 답변 번역
↓
[utils/chat_context.py] 히스토리 업데이트
↓
사용자에게 응답


## �� 실행 방법

```bash
# 1. 의존성 설치
pip install -r requirements.txt

# 2. 환경 변수 설정
# .env 파일에 API 키 및 DB 설정
GEMINI_API_KEY=your_gemini_api_key
POSTGRES_USER=your_db_user
POSTGRES_PASSWORD=your_db_password
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DB=your_db_name

# 3. PDF 데이터 임포트 (최초 1회)
python pdf_importer.py

# 4. 서버 실행
python main.py

# 5. API 테스트
python test_api.py
```

## �� 주요 특징

### 🏗️ 아키텍처 특징
- **모듈화**: 기능별로 명확하게 분리된 구조
- **확장성**: 새로운 기능 추가가 용이
- **유지보수성**: 각 모듈이 독립적으로 관리 가능
- **재사용성**: 서비스 클래스들을 다른 프로젝트에서 재사용 가능
- **테스트 용이성**: 각 모듈을 독립적으로 테스트 가능

### 🔧 기술적 특징
- **LangChain RAG**: PDF 문서 기반 지식 검색
- **다국어 지원**: 4개 언어 (한국어, 미얀마어, 영어, 베트남어)
- **맥락 유지**: 대화 히스토리 기반 자연스러운 대화
- **벡터 검색**: PostgreSQL + pgvector 활용
- **한국어 특화**: KURE-v1 임베딩 모델 사용

### 📊 성능 특징
- **토큰 최적화**: 1000자 청크 + 500자 제한으로 효율성 확보
- **메모리 관리**: 최근 10개 대화만 유지
- **빠른 응답**: Gemini 2.5 Flash Lite 모델 사용
- **확장 가능**: 더 많은 문서 추가 가능

## 🔧 최근 개선사항

### 1. LangChain 구조 개선
- `SystemMessage` + `HumanMessage` 구조 적용
- `system_instruction`을 `model_kwargs`에서 제거
- 더 안정적인 시스템 프롬프트 적용

### 2. 맥락 처리 개선
- 현재 메시지를 맥락에서 제외
- 맥락과 현재 질문을 명확히 구분
- 더 자연스러운 대화 흐름 구현

### 3. RAG 검색 최적화
- 상위 3개 문서 검색
- 500자 길이 제한으로 토큰 절약(바꿔도 됨)
- 한국어 특화 임베딩 모델 활용

### 4. 코드 구조 개선
- 의존성 주입 패턴 적용
- 오류 처리 및 로깅 강화
- 모듈화 및 재사용성 향상